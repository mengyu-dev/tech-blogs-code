FROM --platform=linux/arm64 openjdk:11

EXPOSE 8080

RUN apt update
RUN apt install -y maven
ADD apache-tomcat-8.5.77.zip /tomcat/
WORKDIR /tomcat
RUN unzip /tomcat/apache-tomcat-8.5.77.zip
RUN chmod +x /tomcat/apache-tomcat-8.5.77/bin/*.sh

ADD src/ /helloworld/src
ADD pom.xml /helloworld

#  Build spring app
RUN apt update && apt install maven -y
WORKDIR /helloworld/
RUN mvn clean package

ENV database="This is super complex password"
RUN echo "Nobody should read this confidential file" > /helloworld/confidential.txt

RUN cp target/helloworld.war /tomcat/apache-tomcat-8.5.77/webapps/

CMD ["/tomcat/apache-tomcat-8.5.77/bin/catalina.sh", "run"]