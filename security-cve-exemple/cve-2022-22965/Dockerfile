FROM openjdk:11

EXPOSE 8080

RUN apt update
RUN apt install -y maven
ADD apache-tomcat-8.5.77.zip /tomcat/
WORKDIR /tomcat
RUN unzip /tomcat/apache-tomcat-8.5.77.zip
RUN chmod +x /tomcat/apache-tomcat-8.5.77/bin/*.sh

ADD src/ /cve-demo/src
ADD pom.xml /cve-demo

#  Build spring app
RUN apt update && apt install maven -y
WORKDIR /cve-demo/
RUN mvn clean package

RUN cp target/cve-demo.war /tomcat/apache-tomcat-8.5.77/webapps/

CMD ["/tomcat/apache-tomcat-8.5.77/bin/catalina.sh", "run"]