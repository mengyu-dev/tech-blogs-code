package blog.mengyu;

import org.springframework.data.domain.Sort;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;

@Controller
public class HomeController {
    private final CountRepository countRepository;

    public HomeController(CountRepository countRepository) {
        this.countRepository = countRepository;
    }

    @GetMapping("/home")
    public String home(Model model) {
        Count count = countRepository.findFirstBy(Sort.by("id")).orElse(new Count());
        count.inc();
        countRepository.save(count);
        model.addAttribute("count", count.getValue());
        return "home";
    }

    @PostMapping("/reset")
    public String resetCount(@ModelAttribute Count resetCount, Model model) {
        Count count = countRepository.findFirstBy(Sort.by("id")).orElse(new Count());
        count.setValue(resetCount.getValue());
        countRepository.save(count);
        model.addAttribute("count", count.getValue());
        return "home";
    }

}
